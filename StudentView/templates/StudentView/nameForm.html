<form class="attendance-form" method="POST" action="{% url 'submit_attendance_id' classId %}">
    {% csrf_token %}
    <label for="student_email">CAT email address:</label>
    <input type="text" name="student_email" id="student_email">

    <label for="student_fname">First name:</label>
    <input type="text" name="student_fname" id="student_fname">

    <label for="submit_student">Last Name:</label>
    <input type="text" name="student_lname" id="student_lname">

    <button type="submit" class="submit-button" name="submit_student" id="submit_student" enabled="false">+ Add</button>
    <script>
        const naieveEmail = /^([a-z]+)\.(([a-z]+\.?)+)(?<!\.)(@student\.cat\.org\.uk)?$/i
        const eml = document.getElementById("student_email");
        const fname = document.getElementById("student_fname");
        const lname = document.getElementById("student_lname");
        const btn = document.getElementById("submit_student");

        let fnameFocused = false;
        let lnameFocused = false;

        fname.addEventListener("focus",(event)=>{
            fnameFocused = true;
        });
        lname.addEventListener("focus",(event)=>{
            lnameFocused = true;
        });


        function OnEmailChange(event){
            const regex = naieveEmail.exec(eml.value);
            let btnEnable = false;
            if(regex !== null){
                if(fname.value.length === 0){
                    fnameFocused = false;
                }
                if(fnameFocused == false){
                    fname.value = regex[1];
                }

                if(lname.value.length === 0){
                    lnameFocused = false
                }
                if(lnameFocused == false){
                    lname.value = regex[2];
                }

                btnEnable = eml[eml.length - 1].toLowerCase === '@student.cat.org.uk'
            };

            btn.enabled = btnEnable;
        }
        eml.addEventListener("keyup", OnEmailChange);
        eml.addEventListener("change",OnEmailChange);
    </script>
</form>